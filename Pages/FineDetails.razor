@layout HiddenLayout
@page "/finedetails" 

@inject NavigationManager NavigationManager
@inject IFinePaymentService finePaymentService
@using FinePaymentManagement


<PageTitle>FineDetails</PageTitle>

<h1>Input Fine Details</h1>
<br>

<EditForm Model=@formItems OnValidSubmit=@HandleValidSubmit>
    <DataAnnotationsValidator />

@* Formatting of input fields and image *@
    <div class="col-8 offset -1">
    <div class="form-group row">
    <label>
        Case Reference: 
        <div class="col-6 offset -6">    
        <InputText @bind-Value=formItems.CaseReference id="caseref"/>
        </div>   
    </label><br><br><br>
    <label>
        OnlineAccountReference:
        <div class="col-6 offset -6">  
        <InputText @bind-Value=formItems.OnlineAccountReference id="onlineaccountref"/>
        </div>   
    </label>
    <br><br><br>

    <img src="finenotice75.png" class="mx-auto d-block"><br>
    <br>
    </div>
    </div>

<br><br>

@* Formatting of buttons *@
    <div class="col-8 offset -1">
        <div class="form-group row">
        <div class="col-4">
        <button class="btn btn-secondary" @onclick=GoBack>CANCEL</button> 
        </div>
        <div class="col-4">
        <button class="btn btn-primary" type="submit"> NEXT</button>
        </div>
        </div>
    </div>
</EditForm>



@* <div class="alert alert-danger">
  <strong>Warning!</strong> Indicates a successful or positive action.
</div> *@


@code {

    private FineDetailsFormItems formItems = new FineDetailsFormItems();

    private async void HandleValidSubmit()
    {
        var finePayment = await finePaymentService.SearchFinePayment(formItems.CaseReference,formItems.OnlineAccountReference);

        if (finePayment == null)
        {
            Console.WriteLine("Could not find payment (for many reasons).");
        }
        else if (finePayment.PaymentCompleted)
        {
            NavigationManager.NavigateTo("/finepaid", true);
        }
        else
        {
            NavigationManager.NavigateTo($"/finepayment/{finePayment.Id}", true);
        }
    }
    
    private void GoBack()
    {
        NavigationManager.NavigateTo("/", true); 
    }
}